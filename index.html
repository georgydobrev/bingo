<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silvester Bingo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f9;
            margin: 0;
            padding: 0;
        }

        #container {
            margin-top: 50px;
        }

        #symbol {
            font-size: 18rem;
            font-weight: bold;
            color: #333;
            margin: 20px 0;
        }

        #description {
            font-size: 3rem;
            font-weight: normal;
            color: #555;
            margin-bottom: 3em;
        }

        button {
            font-size: 10rem;
            padding: 10px 20px;
            margin-top: 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        #testTtsButton {
            font-size: 2rem !important;
            background-color: #28a745 !important;
            margin-left: 20px;
        }

        #announced-symbols {
            text-align: left;
            font-size: 5rem;
            margin-top: 40px;
            margin-bottom: 20px;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 30px 40px 30px 30px;
            height: 14rem;
        }

        .announced-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: left;
            gap: 5px;
        }

        .symbol-item {
            font-size: 3rem;
            text-align: center;
            padding: 2px;
        }
    </style>
</head>

<body>
    <div id="container">
        <h1>Neujahrs-Tombola</h1>
        <div id="regeln"><img id="regeln" src="regeln.png" width="40%">
            <p></p>
        </div>
        <button id="startButton" onclick="startGame()">Start</button>
        <button id="testTtsButton" onclick="testTts()">ðŸ”Š Stimme testen</button>
        <div id="symbol"></div>
        <div id="description"></div>
        <div id="announced-symbols">
            <div class="announced-list" id="announcedList"></div>
        </div>
    </div>

    <script>
        const defaultSymbols = [
            { "emoji": "ðŸ”", "img": "1f354", "text": "Hamburger" },
            { "emoji": "ðŸ¾", "img": "1f37e", "text": "Champagner" },
            { "emoji": "ðŸŒ¯", "img": "1f32f", "text": "Burrito" },
            { "emoji": "ðŸ¥“", "img": "1f953", "text": "Speck" },
            { "emoji": "ðŸŽˆ", "img": "1f388", "text": "Ballon" },
            { "emoji": "ðŸ¥©", "img": "1f969", "text": "Steak" },
            { "emoji": "ðŸŽŠ", "img": "1f38a", "text": "Konfetti" },
            { "emoji": "ðŸ¥¯", "img": "1f96f", "text": "Bagel" },
            { "emoji": "ðŸŽ†", "img": "1f386", "text": "Feuerwerk" },
            { "emoji": "ðŸ§€", "img": "1f9c0", "text": "KÃ¤se" },
            { "emoji": "ðŸŽ‚", "img": "1f382", "text": "Kuchen" },
            { "emoji": "ðŸ¥’", "img": "1f952", "text": "Gurke" },
            { "emoji": "ðŸ•¯ï¸", "img": "1f56f_fe0f", "text": "Kerze" },
            { "emoji": "ðŸŒ½", "img": "1f33d", "text": "Mais" },
            { "emoji": "ðŸ¸", "img": "1f438", "text": "Frosch" },
            { "emoji": "ðŸ¥”", "img": "1f954", "text": "Kartoffel" },
            { "emoji": "ðŸ“¯", "img": "1f4ef", "text": "LufttrÃ¶te" },
            { "emoji": "ðŸ§…", "img": "1f9c5", "text": "Zwiebel" },
            { "emoji": "ðŸŽ", "img": "1f381", "text": "Geschenkbox" },
            { "emoji": "ðŸŒ", "img": "1f30d", "text": "Erde" },
            { "emoji": "ðŸ•", "img": "1f355", "text": "Pizza" },
            { "emoji": "ðŸŒ·", "img": "1f337", "text": "Tulpe" },
            { "emoji": "ðŸŒž", "img": "1f31e", "text": "Sonne" },
            { "emoji": "ðŸ€", "img": "1f340", "text": "GlÃ¼cksklee" },
            { "emoji": "ðŸ¦", "img": "1f366", "text": "Eiscreme" },
            { "emoji": "ðŸ‰", "img": "1f349", "text": "Wassermelone" },
            { "emoji": "ðŸ¸", "img": "1f378", "text": "Cocktail" },
            { "emoji": "ðŸ’", "img": "1f352", "text": "Kirschen" },
            { "emoji": "ðŸº", "img": "1f37a", "text": "Bierkrug" },
            { "emoji": "ðŸ", "img": "1f34d", "text": "Ananas" },
            { "emoji": "ðŸ¿", "img": "1f37f", "text": "Popcorn" },
            { "emoji": "ðŸ¥¥", "img": "1f965", "text": "Kokosnuss" },
            { "emoji": "ðŸ§", "img": "1f9c1", "text": "Cupcake" },
            { "emoji": "ðŸŠ", "img": "1f34a", "text": "Orange" },
            { "emoji": "ðŸŒ", "img": "1f34c", "text": "Banane" },
            { "emoji": "ðŸ¬", "img": "1f36c", "text": "Bonbon" },
            { "emoji": "ðŸ³", "img": "1f373", "text": "Spiegelei" },
            { "emoji": "ðŸ‹", "img": "1f34b", "text": "Zitrone" },
            { "emoji": "ðŸ–", "img": "1f356", "text": "Fleisch" },
            { "emoji": "â„ï¸", "img": "2744_fe0f", "text": "Schneeflocke" },
            { "emoji": "ðŸ¥¬", "img": "1f96c", "text": "Salat" },
            { "emoji": "ðŸ", "img": "1f41d", "text": "Biene - oder doch Hummel?" },
            { "emoji": "ðŸ…", "img": "1f345", "text": "Tomate" },
            { "emoji": "â›„", "img": "26c4", "text": "Schneemann" },
            { "emoji": "ðŸ„", "img": "1f344", "text": "Pilz" },
            { "emoji": "â­", "img": "2b50", "text": "Stern" },
            { "emoji": "ðŸŽ‰", "img": "1f389", "text": "PartyHut" },
            { "emoji": "ðŸ•°ï¸", "img": "1f570_fe0f", "text": "Neujahrs-Uhr" },
            { "emoji": "ðŸ””", "img": "1f514", "text": "Glocke" },
            { "emoji": "ðŸŽ’", "img": "1f392", "text": "Rucksack" },
            { "emoji": "ðŸ›·", "img": "1f6f7", "text": "Schlitten" },
            { "emoji": "âš½", "img": "26bd", "text": "FuÃŸball" },
            { "emoji": "ðŸ€", "img": "1f3c0", "text": "Basketball" },
            { "emoji": "ðŸŽ¾", "img": "1f3be", "text": "Tennisball" },
            { "emoji": "ðŸ†", "img": "1f3c6", "text": "Pokal" },
            { "emoji": "ðŸ’§", "img": "1f4a7", "text": "Wassertropfen" },
            { "emoji": "ðŸ”¥", "img": "1f525", "text": "Feuer" },
            { "emoji": "ðŸŒˆ", "img": "1f308", "text": "Regenbogen" },
            { "emoji": "ðŸ", "img": "1f341", "text": "Blatt" },
            { "emoji": "ðŸŒ»", "img": "1f33b", "text": "Sonnenblume" },
            { "emoji": "ðŸŒ¼", "img": "1f33c", "text": "Blume" },
            { "emoji": "ðŸ“", "img": "1f353", "text": "Erdbeere" },
            { "emoji": "ðŸ‡", "img": "1f347", "text": "Trauben" },
            { "emoji": "ðŸ‘", "img": "1f351", "text": "Pfirsich, oder doch ...Arsch?" },
            { "emoji": "ðŸ¥­", "img": "1f96d", "text": "Mango" },
            { "emoji": "ðŸ¥", "img": "1f95d", "text": "Kiwi" },
            { "emoji": "ðŸ", "img": "1f34f", "text": "GrÃ¼ner Apfel" },
            { "emoji": "ðŸŒ®", "img": "1f32e", "text": "Taco" },
            { "emoji": "ðŸ—", "img": "1f357", "text": "HÃ¤hnchenkeule" },
            { "emoji": "ðŸž", "img": "1f35e", "text": "Brot" },
            { "emoji": "ðŸ¥•", "img": "1f955", "text": "Karotte" },
            { "emoji": "ðŸ§„", "img": "1f9c4", "text": "Knoblauch" },
            { "emoji": "ðŸŒ™", "img": "1f319", "text": "Mond" }
        ];

        const ansagen = ["Das nÃ¤chste Bild ist ",
            "Es geht weiter mit ",
            "Und jetzt ",
            "Weiter mit, ",
            " ", " ", " ", " ", " ",
            "Es folgt ",
            "  ", " ", " ", " ", " ", " ", " ", " ",
            "Es wird spannend! ",
            "Nun kommt ",
            "NÃ¤chstes Bild, ",
            "Oh my God! ",
            "Ach cool!",
            "Das gibt ganz Sicher bald Bingo! ",
            "Weiter geht's mit ",
            "Wie bitte?",
            "Es ist so spannend!",
            "Gucci-cool,",
            "Und jetzt noch das!",
            "Oh yeah!",
            "Oh nein!",
            "Wow! ",
            "Oha!",
            "Na Endlich! ",
            "Was zum...?",
            "What the ... !!?"
        ];

        let symbols = [...defaultSymbols];
        let interval = null;
        let isPaused = false;

        function getGermanVoice() {
            const voices = speechSynthesis.getVoices();
            return voices.find(voice => voice.name === "Google Deutsch") || voices.find(voice => voice.lang === "de-DE");
        }

        async function testTts() {
            const btn = document.getElementById('testTtsButton');
            btn.disabled = true;
            btn.textContent = 'â³ LÃ¤dt...';
            const text = 'Herzlich willkommen beim Neujahrs-Bingo! Gleich werden bunte Symbole gezogen â€“ Hamburger, Feuerwerk, Champagner und viele mehr. Wer zuerst vier in einer Reihe hat, ruft laut Bingo! Viel SpaÃŸ und ein frohes neues Jahr!';
            await speak(text);
            btn.disabled = false;
            btn.textContent = 'ðŸ”Š Stimme testen';
        }

        async function speak(text) {
            try {
                const audio = new Audio('/api/tts?text=' + encodeURIComponent(text));
                await audio.play();
            } catch (e) {
                const utterance = new SpeechSynthesisUtterance(text);
                const germanVoice = getGermanVoice();
                if (germanVoice) utterance.voice = germanVoice;
                utterance.lang = "de-DE";
                speechSynthesis.speak(utterance);
            }
        }

        function startGame() {
            isPaused = false;
            clearAnnouncedSymbols();
            getGermanVoice();
            symbols = [...defaultSymbols];
            document.getElementById('startButton').hidden = true;
            document.getElementById('testTtsButton').hidden = true;
            document.getElementById('regeln').hidden = true;
            document.getElementById('symbol').textContent = "Los geht's!";
            document.getElementById('description').textContent = "";

            if (interval) clearInterval(interval);

            interval = setInterval(() => {
                if (isPaused || symbols.length === 0) return;

                const randomIndex = Math.floor(Math.random() * symbols.length);
                const selectedSymbol = symbols.splice(randomIndex, 1)[0];
                if (selectedSymbol.img) {
                    const animatedUrl = 'https://fonts.gstatic.com/s/e/notoemoji/latest/' + selectedSymbol.img + '/512.gif';
                    document.getElementById('symbol').innerHTML = '<img src="' + animatedUrl + '" alt="' + selectedSymbol.emoji + '" width="300" height="300" onerror="this.outerHTML=this.alt;">';
                } else {
                    document.getElementById('symbol').innerHTML = selectedSymbol.emoji;
                }
                document.getElementById('description').textContent = selectedSymbol.text;

                speak(ansagen[Math.floor(Math.random() * ansagen.length)] + "--" + selectedSymbol.text + "!!");
                updateAnnouncedSymbols(selectedSymbol.emoji);

                if (symbols.length === 0) {
                    setTimeout(() => { stopGame(); }, 5000);
                }
            }, Math.floor(Math.random() * 5001) + 6000);
        }

        function stopGame() {
            if (interval) {
                clearInterval(interval);
                interval = null;
                document.getElementById('symbol').textContent = "Ende!";
                document.getElementById('description').textContent = "";
                speak("Spiel ist zu Ende! Wollt ihr noch mal spielen! Dann drÃ¼ckt einfach auf die Taste S!");
            }
        }

        function updateAnnouncedSymbols(emoji) {
            const announcedList = document.getElementById('announcedList');
            const symbolElement = document.createElement('div');
            symbolElement.className = 'symbol-item';
            symbolElement.innerHTML = `${emoji} <br>`;
            announcedList.appendChild(symbolElement);
        }

        function clearAnnouncedSymbols() {
            document.getElementById('announcedList').replaceChildren();
        }

        function pauseGame(key, symbol, text) {
            if (isPaused) {
                document.getElementById('symbol').hidden = false;
                document.getElementById('description').hidden = false;
                document.getElementById('regeln').hidden = true;
                speak("Gleich geht's weiter!");
                document.getElementById('description').textContent = "Gleich geht's weiter";
                isPaused = false;
                return;
            }
            if (!isPaused) {
                document.getElementById('symbol').textContent = symbol + "!";
                document.getElementById('description').textContent = text + "!";
                isPaused = true;
                speak(text + ".");
                updateAnnouncedSymbols(key);
            }
        }

        document.addEventListener('keydown', event => {
            if (event.key === 'l') pauseGame("L", "Linie", "Linie wurde gemeldet");
            if (event.key === 'p') pauseGame("", "Pause", "Spiel wurde pausiert");
            if (event.key === 'b') pauseGame("B", "Bingo", "Jemand hat endlich Bingo gemeldet! Herzlichen GlÃ¼ckwunsch!");
            if (event.key === '2') pauseGame("2", "Duo", "Wa-as?? So schnell?! Jemand hat Duo gemeldet!");
            if (event.key === '3') pauseGame("3", "Trio", "Und jetzt schon Trio!");
            if (event.key === 's') startGame();
            if (event.key == 'q') {
                if (isPaused) {
                    isPaused = false;
                    document.getElementById('regeln').hidden = true;
                    document.getElementById('symbol').hidden = false;
                    document.getElementById('description').hidden = false;
                } else { isPaused = true; }
            }
            if (event.key == 'r') {
                if (isPaused) {
                    isPaused = false;
                    document.getElementById('regeln').hidden = true;
                    document.getElementById('symbol').hidden = false;
                    document.getElementById('description').hidden = false;
                } else {
                    document.getElementById('regeln').hidden = false;
                    document.getElementById('symbol').hidden = true;
                    document.getElementById('description').hidden = true;
                    isPaused = true;
                }
            }
        });
    </script>
</body>

</html>
